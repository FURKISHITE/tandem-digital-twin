<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Opet ƒ∞stasyon Y√∂netimi Pro</title>
    <style>
        :root {
            --opet-blue: #004990;
            --opet-dark-blue: #003366;
            --opet-yellow: #FFC20E;
            --bg-color: #f0f2f5;
            --sidebar-width: 280px;
        }

        body { 
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif; 
            margin: 0; padding: 0; background-color: var(--bg-color); 
            color: #333; height: 100vh; overflow: hidden;
        }

        /* --- LOGIN EKRANI --- */
        #loginScreen {
            display: flex; flex-direction: column; align-items: center; 
            justify-content: center; height: 100vh; width: 100%;
            background: linear-gradient(135deg, var(--opet-blue) 0%, var(--opet-dark-blue) 100%);
            position: absolute; z-index: 2000; top: 0; left: 0;
        }

        .login-box {
            background: white; padding: 40px; border-radius: 15px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); width: 90%; max-width: 350px;
            text-align: center; border-top: 6px solid var(--opet-yellow);
        }

        /* --- DASHBOARD LAYOUT --- */
        #dashboardScreen {
            display: flex; height: 100vh; width: 100%;
        }

        /* SOL SIDEBAR (GE√áMƒ∞≈û) */
        .sidebar {
            width: var(--sidebar-width);
            background-color: white;
            border-right: 1px solid #ddd;
            display: flex; flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            z-index: 100;
        }

        .sidebar-header {
            height: 70px; background: var(--opet-blue);
            display: flex; align-items: center; justify-content: center;
            border-bottom: 5px solid var(--opet-yellow);
        }

        .history-list {
            flex: 1; overflow-y: auto; padding: 15px;
        }

        .history-item {
            background: #fff; border-left: 4px solid #ddd;
            padding: 10px; margin-bottom: 10px; border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); font-size: 13px;
            transition: all 0.2s;
        }
        .history-item.new { border-left-color: #28a745; background-color: #f0fff4; }
        .history-item .time { font-weight: bold; color: var(--opet-blue); display: block; }
        .history-item .user { color: #666; font-size: 11px; }

        .sidebar-title {
            padding: 15px; font-weight: bold; color: #444; border-bottom: 1px solid #eee;
            background: #fafafa; display: flex; justify-content: space-between;
        }

        /* ANA ƒ∞√áERƒ∞K */
        .main-content {
            flex: 1; display: flex; flex-direction: column; 
            overflow-y: auto; position: relative;
        }

        .top-bar {
            height: 70px; background: white; 
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; border-bottom: 1px solid #eee;
        }

        .content-body {
            padding: 30px; display: flex; justify-content: center;
        }

        .panel-card {
            background: white; padding: 30px; border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); width: 100%; max-width: 500px;
        }

        /* FORM ELEMANLARI */
        input, select {
            width: 100%; padding: 12px; border: 1px solid #ddd;
            border-radius: 8px; margin-bottom: 15px; box-sizing: border-box;
        }
        
        .btn {
            width: 100%; padding: 15px; border: none; border-radius: 8px;
            background: var(--opet-blue); color: white; font-weight: bold;
            cursor: pointer; transition: 0.2s;
        }
        .btn:hover { background: var(--opet-dark-blue); }
        .clean-btn { background: #28a745; margin-top: 10px; }
        .clean-btn:disabled { background: #ccc; cursor: not-allowed; }

        /* CHECKLIST */
        .checklist {
            background: #f8f9fa; padding: 15px; border-radius: 8px;
            margin-bottom: 20px; text-align: left;
        }
        .check-item {
            display: flex; align-items: center; margin-bottom: 10px; cursor: pointer;
        }
        .check-item input { width: 18px; height: 18px; margin: 0 10px 0 0; }

        /* YARDIMCI G√ñRSELLER */
        .logo-svg { height: 35px; width: auto; }
        .weather-widget { display: flex; align-items: center; gap: 10px; font-size: 14px; color: #555; }
        
        .hidden { display: none !important; }

        /* Responsive */
        @media (max-width: 768px) {
            #dashboardScreen { flex-direction: column; }
            .sidebar { width: 100%; height: 200px; order: 2; }
            .sidebar-header { display: none; }
            .main-content { height: auto; order: 1; }
        }
    </style>
</head>
<body>

    <div id="loginScreen">
        <div class="login-box">
            <svg class="logo-svg" viewBox="0 0 300 100" style="height:50px; margin-bottom:20px;">
                <text x="10" y="75" font-family="Arial" font-weight="900" font-style="italic" font-size="80" fill="#004990" letter-spacing="-2">opet</text>
                <path d="M10 85 L180 85" stroke="#FFC20E" stroke-width="8" stroke-linecap="round"/>
            </svg>
            <h3 style="color:#004990; margin:0 0 20px 0;">Personel Giri≈üi</h3>
            <input type="text" id="username" placeholder="Kullanƒ±cƒ± Adƒ± (admin)">
            <input type="password" id="password" placeholder="≈ûifre (123456)">
            <button class="btn" onclick="login()">Gƒ∞Rƒ∞≈û YAP</button>
            <p id="loginMsg" style="color:red; font-size:12px; display:none; margin-top:10px;">Hatalƒ± giri≈ü!</p>
        </div>
    </div>

    <div id="dashboardScreen" class="hidden">
        
        <div class="sidebar">
            <div class="sidebar-header">
                <svg viewBox="0 0 300 100" style="height:30px;">
                    <text x="10" y="75" font-family="Arial" font-weight="900" font-style="italic" font-size="80" fill="white" letter-spacing="-2">opet</text>
                </svg>
            </div>
            <div class="sidebar-title">
                <span>üïí Son ƒ∞≈ülemler</span>
                <span style="font-size:12px; color:#999; cursor:pointer;" onclick="clearHistory()">Temizle</span>
            </div>
            <div class="history-list" id="historyContainer">
                <div style="text-align:center; color:#999; margin-top:20px; font-size:12px;">Hen√ºz kayƒ±t yok</div>
            </div>
        </div>

        <div class="main-content">
            <div class="top-bar">
                <div style="font-weight:bold; color:#004990;">
                    √áekmek√∂y Kuzey ƒ∞stasyonu
                </div>
                <div class="weather-widget">
                    <span>‚òÅÔ∏è 14¬∞C</span>
                    <span id="liveClock" style="font-weight:bold;">12:00</span>
                    <button onclick="logout()" style="background:none; border:none; color:red; cursor:pointer; margin-left:10px; font-size:12px;">√áƒ±kƒ±≈ü</button>
                </div>
            </div>

            <div class="content-body">
                <div class="panel-card">
                    <h2 style="color:var(--opet-blue); border-bottom:3px solid var(--opet-yellow); padding-bottom:10px; display:inline-block;">WC Temizlik</h2>
                    
                    <p style="font-size:13px; color:#666;">L√ºtfen temizliƒüi yapan personeli se√ßiniz ve kontrol listesini onaylayƒ±nƒ±z.</p>

                    <select id="staffName">
                        <option value="" disabled selected>Personel Se√ßiniz...</option>
                        <option value="Ahmet Yƒ±lmaz">Ahmet Yƒ±lmaz</option>
                        <option value="Mehmet Demir">Mehmet Demir</option>
                        <option value="Ay≈üe Kaya">Ay≈üe Kaya</option>
                    </select>

                    <div class="checklist">
                        <label class="check-item"><input type="checkbox" class="task-check" onchange="validate()"> Zemin Silindi</label>
                        <label class="check-item"><input type="checkbox" class="task-check" onchange="validate()"> Sabun / Kaƒüƒ±t Tamam</label>
                        <label class="check-item"><input type="checkbox" class="task-check" onchange="validate()"> Kokulandƒ±rma Yapƒ±ldƒ±</label>
                    </div>

                    <button id="resetBtn" class="btn clean-btn" onclick="sendSignal()" disabled>‚úÖ TEMƒ∞ZLƒ∞ƒûƒ∞ KAYDET</button>
                    <div id="status" style="margin-top:15px; font-size:13px; display:none;"></div>
                </div>
            </div>
            
            <div style="position:absolute; bottom:10px; right:10px; font-size:10px; color:#ccc;">Oto-√áƒ±kƒ±≈ü: 1 dk</div>
        </div>
    </div>

<script>
    let inactivityTimer;

    // --- BA≈ûLANGI√á ---
    window.onload = function() {
        renderHistory(); // Ge√ßmi≈üi y√ºkle
        updateClock();
        setInterval(updateClock, 1000);

        if(localStorage.getItem('opet_session') === 'active') {
            showDashboard();
        }
    };

    // --- Gƒ∞Rƒ∞≈û ƒ∞≈ûLEMLERƒ∞ ---
    function login() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        if(u === 'admin' && p === '123456') {
            localStorage.setItem('opet_session', 'active');
            showDashboard();
        } else {
            document.getElementById('loginMsg').style.display = 'block';
        }
    }

    function showDashboard() {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('dashboardScreen').classList.remove('hidden');
        startInactivityTimer();
    }

    function logout() {
        localStorage.removeItem('opet_session');
        location.reload();
    }

    // --- GE√áMƒ∞≈û KAYITLARI Y√ñNETƒ∞Mƒ∞ (LOCALSTORAGE) ---
    function addLogToHistory(staffName) {
        const now = new Date();
        const timeStr = now.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'});
        const dateStr = now.toLocaleDateString('tr-TR', {day:'numeric', month:'short'});
        
        // Yeni kayƒ±t objesi
        const newLog = {
            time: timeStr,
            date: dateStr,
            user: staffName,
            id: Date.now()
        };

        // Mevcut listeyi √ßek, yeniyi ekle, kaydet
        let logs = JSON.parse(localStorage.getItem('cleaningLogs') || '[]');
        logs.unshift(newLog); // En ba≈üa ekle
        
        // Max 50 kayƒ±t tutalƒ±m
        if(logs.length > 50) logs = logs.slice(0, 50);
        
        localStorage.setItem('cleaningLogs', JSON.stringify(logs));
        renderHistory();
    }

    function renderHistory() {
        const container = document.getElementById('historyContainer');
        const logs = JSON.parse(localStorage.getItem('cleaningLogs') || '[]');

        if(logs.length === 0) {
            container.innerHTML = '<div style="text-align:center; color:#ccc; margin-top:20px;">Hen√ºz kayƒ±t yok.</div>';
            return;
        }

        let html = '';
        logs.forEach((log, index) => {
            // ƒ∞lk kayda 'new' sƒ±nƒ±fƒ± ekle (ye≈üil kenar)
            const isNew = index === 0 ? 'new' : '';
            html += `
                <div class="history-item ${isNew}">
                    <span class="time">‚úÖ ${log.time} <span style="font-weight:normal; font-size:11px; color:#999;">(${log.date})</span></span>
                    <span class="user">üë§ ${log.user}</span>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    function clearHistory() {
        if(confirm("T√ºm ge√ßmi≈ü kayƒ±tlar silinsin mi?")) {
            localStorage.removeItem('cleaningLogs');
            renderHistory();
        }
    }

    // --- FORM KONTROLLERƒ∞ ---
    function validate() {
        const checks = document.querySelectorAll('.task-check');
        const staff = document.getElementById('staffName').value;
        const btn = document.getElementById('resetBtn');
        
        let allChecked = true;
        checks.forEach(c => { if(!c.checked) allChecked = false; });

        // Hem kutucuklar i≈üaretli olmalƒ± hem personel se√ßili olmalƒ±
        if(allChecked && staff !== "") {
            btn.disabled = false;
            btn.innerHTML = "‚úÖ TEMƒ∞ZLƒ∞ƒûƒ∞ KAYDET";
        } else {
            btn.disabled = true;
            btn.innerHTML = "‚ö†Ô∏è Eksikleri Tamamlayƒ±n";
        }
    }

    // Se√ßim kutusu deƒüi≈üince de kontrol et
    document.getElementById('staffName').addEventListener('change', validate);

    // --- GITHUB ƒ∞≈ûLEMƒ∞ VE KAYIT ---
    async function sendSignal() {
        resetTimer();
        const btn = document.getElementById('resetBtn');
        const status = document.getElementById('status');
        const staffName = document.getElementById('staffName').value;

        // GitHub Ayarlarƒ±
        const OWNER = "FURKISHITE";
        const REPO = "tandem-digital-twin";
        const WORKFLOW_ID = "tandem_bot.yml";
        const p1 = "ghp_u5Ab9KDL1L73r"; 
        const p2 = "ZpnsNasO5OC7qUAhB2xxiXS";
        const TOKEN = (p1 + p2).trim();

        btn.disabled = true;
        btn.innerHTML = "‚è≥ Kaydediliyor...";
        status.style.display = 'block';
        status.innerHTML = "Sunucu ile senkronize ediliyor...";
        status.style.color = "blue";

        try {
            // √ñnce GitHub isteƒüi
            const response = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/actions/workflows/${WORKFLOW_ID}/dispatches`, {
                method: 'POST',
                headers: {
                    'Authorization': 'token ' + TOKEN,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ ref: 'main' })
            });

            if(response.status === 204 || response.ok) {
                // Ba≈üarƒ±lƒ±ysa Yerel Ge√ßmi≈üe Ekle
                addLogToHistory(staffName);
                
                status.innerHTML = "‚úÖ Ba≈üarƒ±yla Kaydedildi!";
                status.style.color = "green";
                
                // Formu sƒ±fƒ±rla
                setTimeout(() => {
                    document.querySelectorAll('.task-check').forEach(c => c.checked = false);
                    document.getElementById('staffName').value = "";
                    validate();
                    status.style.display = 'none';
                }, 3000);
            } else {
                throw new Error("GitHub Hatasƒ±: " + response.status);
            }

        } catch(e) {
            status.innerHTML = "‚ö†Ô∏è Hata: " + e.message;
            status.style.color = "red";
            btn.disabled = false;
        }
    }

    // --- SAAT VE OTO √áIKI≈û ---
    function updateClock() {
        const now = new Date();
        document.getElementById('liveClock').innerText = now.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'});
    }

    function startInactivityTimer() {
        document.onmousemove = resetTimer;
        document.onclick = resetTimer;
        document.onkeypress = resetTimer;
        document.ontouchstart = resetTimer;
        resetTimer();
    }
    function resetTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(logout, 60000); // 1 dk
    }
</script>

</body>
</html>
